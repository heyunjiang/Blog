# serverless 入门

time: 2020.12.31  
author: heyunjiang

## 1 背景

今天开始学习 serverless 相关知识，基于以下原因  
1. 学习 nodejs 后端，结合具体方向使用相关技术，了解软件全流程
2. 团队有相关业务，学习 + 实战

## 2 基础知识

1. serverless 就是一套工具，减少运维成本，扩展前端技术层面，激发前端创造力，前端工程师可以做完整应用
2. 狭义 serverless：Faas + Baas
3. 广义 serverless：任何不需要运维或弱运维的服务
3. 由 BFF => SFF

## 3 Faas

1. 接受 http 请求
2. 结构：触发器 + 函数服务 + 函数代码
3. 运行环境：整体运行在容器中，内部提供了 runtime，比如 os、硬件信息、环境变量、nodejs 环境、三方依赖、代码
4. 进程类型：常驻内存型 + 用完即毁型
5. 括缩容：一版指横向括缩容，增加机子台数
6. 冷启动流程：系统资源调度、下载函数代码、启动容器、启动 runtime、函数初始化、函数执行
7. cass: container as a service，指的是容器服务
8. docker 与 vm 不同：docker 基于同一进程，是在不同线程级别操作，共享内存，优点是轻量、启动速度更快、代码执行速度更快。可以将 docker 部署在任何 docker 引擎上
9. 容器括缩容：监听容器指标 cpu 利用率、内存使用率、硬盘使用率、网络链接数等，某一指标超出预估水位，则需要扩容，低于水位，则缩容

> 云服务发展历史：裸机房、vm 虚拟机、Iaas、Paas、Baas、Caas、ServerLess  

优点：  
1. 不使用时缩容到0
2. 使用时可以极速冷启动，因为只需要启动容器 + 前端运行时，其他服务由 Baas 层提供

## 4 Baas

1. 后端 Baas 化包含：数据库、dns、网关、
2. 微服务调用：RPC
3. Serverless Baas 服务调用：HTTP
4. 微服务10要素：`API、服务调用、服务发现；日志、链路追踪；容灾、监控、括缩容；发布管道；鉴权`
5. 领域驱动 DDD：通过对业务分层抽象，分析定义出领域模型，用领域模型驱动设计系统，将复杂的业务模型拆分为独立运维的领域模型
6. 动态网络节点：后端各 Baas 节点是动态的，分分合合。优化目的是减少核心节点、保护核心节点、降低网络调用链深度
7. 服务编排：服务节点合并，是操作动态网络节点的一种高级说法
8. JWT：通过统一鉴权服务，生成 JWT 字符串，也就是数字签名，预签名，每次 http 请求都带上
9. 发布：发布管道，发布流水线，cicd，灰度
